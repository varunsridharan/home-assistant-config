hall_announcer_time_announcer:
    alias: "ðŸ“£ Hall Announcer : Current Time & Weather"
    mode: single
    icon: mdi:archive-clock-outline
    variables:
        hour24: "{{ now().timestamp() | timestamp_custom('%H', true) | int }}"
        hour12: "{{ now().timestamp() | timestamp_custom('%-I', true) | int }}"
        minute: "{{ now().minute | int }}"

        temperature: >-
            {% if states('sensor.openweathermap_temperature') != 'unavailable' %}
                {{ ((float(states('sensor.openweathermap_temperature')) * 9 / 5 )  + 32) | round(0) }}
            {% else %}
                unavailable
            {% endif %}

        cloud_coverage: >-
            {% if states('sensor.openweathermap_forecast_cloud_coverage') != 'unavailable' %}
                {{ states('sensor.openweathermap_forecast_cloud_coverage') }}
            {% else %}
                unavailable
            {% endif %}

        humidity: >-
            {% if states('sensor.openweathermap_humidity') != 'unavailable' %}
                {{ states('sensor.openweathermap_humidity') }}
            {% else %}
                unavailable
            {% endif %}

        wind_speed: >-
            {% if states('sensor.openweathermap_wind_speed') != 'unavailable' %}
                {{ (( states('sensor.openweathermap_wind_speed') | int ) * 3.6 | float) }}
            {% else %}
                unavailable
            {% endif %}

        timetype: >-
            {% if (hour24 >= 23 and hour24 <= 24) %}à®¨à®³à¯à®³à®¿à®°à®µà¯
            {% elif (hour24 >= 19 and hour24 <= 22) %}à®‡à®°à®µà¯
            {% elif (hour24 >= 16 and hour24 <= 18) %}à®šà®¾à®¯à®™à¯à®•à®¾à®²à®®à¯
            {% elif (hour24 >= 11 and hour24 <= 15) %}à®®à®¤à®¿à®¯à®®à¯
            {% elif (hour24 >= 6 and hour24 <= 10) %}à®•à®¾à®²à¯ˆ
            {% elif (hour24 >= 4 and hour24 <= 5) %}à®…à®¤à®¿à®•à®¾à®²à¯ˆ
            {% elif (hour24 >= 1 and hour24 <= 3) %}à®¨à®³à¯à®³à®¿à®°à®µà¯{% endif %}

        time_text: "à®¨à¯‡à®°à®®à¯ à®‡à®ªà¯à®ªà¯‹à®¤à¯ . {{ timetype }} {{ hour12 }} à®®à®£à®¿ {% if minute > 1 %} . {{ minute }} à®¨à®¿à®®à®¿à®Ÿà®®à¯ {% endif %}"

        weather_report: >-
            à®¤à®±à¯à®ªà¯‹à®¤à¯ˆà®¯ à®µà®¾à®©à®¿à®²à¯ˆ à®…à®±à®¿à®•à¯à®•à¯ˆ ..
            {% if temperature != unavailable %} à®µà¯†à®ªà¯à®ªà®¨à®¿à®²à¯ˆ . {{ temperature }} à®Ÿà®¿à®•à®¿à®°à®¿ à®ƒà®ªà®¾à®°à®©à¯à®¹à¯€à®Ÿà¯ . . {% endif %}
            {% if humidity != unavailable %} à®ˆà®°à®ªà¯à®ªà®¤à®®à¯ . {{ humidity }} à®šà®¤à®µà¯€à®¤à®®à¯à®®à®¾à®• à®‰à®³à¯à®³à®¤à¯ . . {% endif %}
            {% if wind_speed != unavailable %} {{ wind_speed }} à®•à®¿à®²à¯‹à®®à¯€à®Ÿà¯à®Ÿà®°à¯ à®µà¯‡à®•à®¤à¯à®¤à®¿à®²à¯ à®•à®¾à®±à¯à®±à¯ à®µà¯€à®šà¯à®•à®¿à®±à®¤à¯ . . {% endif %}
            {% if cloud_coverage != unavailable %}  à®µà®¾à®©à®®à¯ {{ cloud_coverage }} à®šà®¤à®µà¯€à®¤à®®à¯ à®®à¯‡à®•à®®à¯‚à®Ÿà¯à®Ÿà®¤à¯à®¤à¯à®Ÿà®©à¯ à®•à®¾à®£à®ªà¯à®ªà®Ÿà¯à®®à¯ {% endif %}

        message: >-
            {{ time_text }}
            {% if hour24 == 6 or hour24 == 7 or hour24 == 12 or hour24 == 13 or hour24 == 18 %}
                {% if minute == 0 or minute == 30 %}
                    {{weather_report }}
                {% endif %}
            {% endif %}

            .....

            {{ time_text }}
            {% if hour24 == 6 or hour24 == 7 or hour24 == 12 or hour24 == 13 or hour24 == 18 %}
                {% if minute == 0 or minute == 30 %}
                    {{weather_report }}
                {% endif %}
            {% endif %}

    sequence:
        - repeat:
              count: "1"
              sequence:
                  - service: script.hall_announcer_notify
                    data:
                        message: "{{ message }}"
                        google_voice: "ta"
                  #- delay:
                  #      hours: 0
                  #      minutes: 0
                  #      seconds: 10
                  #      milliseconds: 0
